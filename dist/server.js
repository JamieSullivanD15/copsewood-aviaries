!function(n){var r={};function s(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.m=n,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(n,r,function(e){return t[e]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=9)}([function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("passport")},function(e,t,n){"use strict";var r=n(0).Schema({username:{type:String,required:!0},password:{type:String,required:!0},addedBy:{type:String},updatedBy:{type:String}});e.exports=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.verifyToken=function(n,r,s){var e=n.cookies.jwt;{if(void 0===e)return r.status(403).send({success:!1,message:"No token provided"});i.verify(e,o,function(e,t){if(e)return r.json({success:!1,message:"Failed to authenticate token"});n.decoded=t,s()})}};var i=n(8),o=t.JWT_KEY="671t^U#LsJrRFV992Gbs0hR9^HyL50"},function(e,t){e.exports=require("bcryptjs")},function(e,t,n){"use strict";var r=n(0).Schema({images:[{fieldname:String,originalname:String,encoding:String,mimetype:String,destination:String,filename:String,path:String,size:Number}],breed:{type:String,required:!0},price:{type:Number,required:!0},category:{type:String,required:!0},addedBy:{type:String}});e.exports=r},function(e,t,n){"use strict";var r=n(0).Schema({name:{type:String,required:!0},price:{type:Number,required:!0}});e.exports=r},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,r){"use strict";var n=l(r(1)),s=l(r(0)),i=l(r(10)),o=l(r(11)),a=l(r(12)),u=l(r(13)),c=l(r(14)),d=l(r(2)),f=l(r(15));function l(e){return e&&e.__esModule?e:{default:e}}var p=(0,n.default)(),g=process.env.PORT||3e3,m=r(16).__express;p.engine(".ejs",m),p.set("views",o.default.join(__dirname,"views")),p.set("view engine","ejs"),p.use(n.default.static(o.default.join(__dirname,"public"))),p.use("/uploads",n.default.static("uploads")),p.use(i.default.urlencoded({extended:!0})),p.use(i.default.json()),p.use((0,f.default)()),p.use((0,u.default)({secret:"keyboard cat",resave:!0,saveUninitialized:!0})),p.use((0,c.default)()),p.use(function(e,t,n){t.locals.messages=r(17)(e,t),n()}),p.use((0,a.default)({errorFormatter:function(e,t,n){for(var r=e.split("."),s=r.shift();r.length;)s+="["+r.shift()+"]";return{param:s,msg:t,value:n}}})),p.use(function(e,t,n){if("/"==e.path.substr(-1)&&1<e.path.length){var r=e.url.slice(e.path.length);t.redirect(301,e.path.slice(0,-1)+r)}else n()}),r(18)(d.default),p.use(d.default.initialize()),p.use(d.default.session()),p.get("*",function(e,t,n){t.locals.user=e.user||null,n()});var y=process.env.MONGO_URI||r(20).MONGO_URI;s.default.connect(y,{useNewUrlParser:!0}).then(function(){return console.log("MongoDB Connected...")}).catch(function(e){return console.log(e)});var h=r(21);p.use("/",h);var b=r(22);p.use("/api/birds",b);var v=r(25);p.use("/api/products",v);var w=r(26);p.use("/api/admins",w),p.listen(g,function(){console.log("Server Started on "+g)})},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("express-validator")},function(e,t){e.exports=require("express-session")},function(e,t){e.exports=require("connect-flash")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("ejs")},function(e,t){e.exports=require("express-messages")},function(e,t,n){"use strict";var r=n(19).Strategy,s=n(0),i=n(5),o=n(3),a=s.model("Admin",o);e.exports=function(e){e.use(new r(function(e,t,r){var n={username:e};a.findOne(n,function(e,n){if(e)throw e;if(!n)return r(null,!1,{message:"No Admin Found"});i.compare(t,n.password,function(e,t){if(e)throw e;return t?r(null,n):r(null,!1,{message:"Wrong Password"})})})})),e.serializeUser(function(e,t){t(null,e.id)}),e.deserializeUser(function(e,n){a.findById(e,function(e,t){n(e,t)})})}},function(e,t){e.exports=require("passport-local")},function(e,t,n){"use strict";e.exports={MONGO_URI:"mongodb://jamie:j6iQQA@ds115553.mlab.com:15553/copsewood-aviaries"}},function(e,t,n){"use strict";var r=n(1).Router(),s=n(0),i=(n(2),n(6)),o=s.model("Bird",i),a=n(7),u=s.model("Product",a),c=n(3),d=s.model("Admin",c);function f(e,t,n){if(e.isAuthenticated())return n();e.flash("alert alert-danger","You Must Be Logged In To Access This Page"),t.status(401).redirect("/login")}r.get("/",function(e,t){t.render("pages/index",{title:"Home"})}),r.get("/admin-panel",f,function(e,n){d.find({},function(e,t){e?console.log(e):n.render("pages/admin-panel",{title:"Admins",admins:t})})}),r.get("/admins",f,function(e,n){d.find({},function(e,t){e?console.log(e):n.render("pages/admins",{title:"Admins",admins:t})})}),r.get("/about",function(e,t){t.render("pages/about",{title:"About"})}),r.get("/birds",function(e,n){o.find({},function(e,t){e?console.log(e):n.render("pages/birds",{title:"Birds",birds:t})})}),r.get("/products",function(e,n){u.find({},function(e,t){e?console.log(e):n.render("pages/products",{title:"Products",products:t})})}),r.get("/contact",function(e,t){t.render("pages/contact",{title:"Contact"})}),r.get("/login",function(e,t){t.render("pages/login",{title:"Login"})}),r.get("/birds_:id",function(e,n){o.findById(e.params.id,function(e,t){n.render("object-info/bird",{title:t.breed,bird:t,isEditing:!1})})}),r.get("/products_:id",function(e,n){u.findById(e.params.id,function(e,t){n.render("object-info/product",{title:t.name,product:t,isEditing:!1})})}),r.get("/admins_:id",f,function(e,n){d.findById(e.params.id,function(e,t){n.render("object-info/admin",{title:t.name,admin:t,isEditing:!1})})}),r.get("/edit-bird_:id",f,function(e,n){o.findById(e.params.id,function(e,t){n.render("object-info/bird",{title:t.breed,bird:t,isEditing:!0})})}),r.get("/edit-product_:id",f,function(e,n){u.findById(e.params.id,function(e,t){n.render("object-info/product",{title:t.name,product:t,isEditing:!0})})}),r.get("/edit-admin_:id",f,function(e,n){d.findById(e.params.id,function(e,t){n.render("object-info/admin",{title:t.name,admin:t,isEditing:!0})})}),e.exports=r},function(e,t,n){"use strict";var r=n(1).Router(),s=n(0),i=n(23),o=n(24),a=n(6),u=s.model("Bird",a),c=n(4).verifyToken,d=i({storage:i.diskStorage({destination:function(e,t,n){n(null,"./uploads/birds")},filename:function(e,t,n){n(null,Date.now()+t.originalname)}}),fileFilter:function(e,t,n){"image/jpeg"===t.mimetype||"image/jpg"===t.mimetype||"image/png"===t.mimetype?n(null,!0):n(null,!1)}});r.get("/",c,function(e,t){u.find().sort({breed:1}).then(function(e){return t.status(200).send(e)}).catch(function(e){return t.status(404)})}),r.get("/:id",c,function(e,t){u.findById(e.params.id).then(function(e){return t.status(200).send(e)}).catch(function(e){return t.status(404).json({success:!1})})}),r.post("/",d.any("images"),c,function(t,n){t.checkBody("breed","Breed is Required").notEmpty(),t.checkBody("price","Price is Required").notEmpty(),t.checkBody("category","Category is Required").notEmpty();var e=t.validationErrors();if(e)e.forEach(function(e){t.flash("alert alert-danger",e.msg)}),n.status(404).redirect("/admin-panel");else{var r=new u({images:t.files,breed:t.body.breed,price:t.body.price,category:t.body.category,addedBy:t.user.username});r.save().then(function(e){t.flash("alert alert-success",r.breed+" Was Created Successfully"),n.status(200).redirect("/")}).catch(function(e){return console.log(e)})}}),r.post("/:id",c,function(t,n){var e={breed:t.body.breed,price:t.body.price,category:t.body.category};u.findByIdAndUpdate(t.params.id,e).then(function(e){t.flash("alert alert-success",e.breed+" Was Updated Successfully"),n.status(200).redirect("/birds")}).catch(function(e){return n.status(404)})}),r.delete("/:id",c,function(n,r){var s=void 0;u.findById(n.params.id).then(function(e){if(-1<e.images.length)for(var t=0;t<e.images.length;++t)s=e.images[t].path,o.existsSync(s)&&o.unlink(s,function(e){e&&console.log(e)});e.remove().then(function(){n.flash("alert alert-success",e.breed+" Was Deleted"),r.status(200).redirect("/birds")})}).catch(function(e){console.log(e),r.status(404).json({success:!1})})}),e.exports=r},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var r=n(1).Router(),s=n(0),i=n(7),o=s.model("Product",i);r.get("/",function(e,t){o.find().sort({price:1}).then(function(e){return t.status(200)}).catch(function(e){return t.status(404)})}),r.get("/:id",function(e,t){o.findById(e.params.id).then(function(e){return t.status(200)}).catch(function(e){return t.status(404).json({success:!1})})}),r.post("/",function(t,n){t.checkBody("name","Name is Required").notEmpty(),t.checkBody("price","Price is Required").notEmpty();var e=t.validationErrors();e?(e.forEach(function(e){t.flash("alert alert-danger",e.msg)}),n.status(404).redirect("/admin-panel")):new o({name:t.body.name,price:t.body.price}).save().then(function(e){t.flash("alert alert-success","New Product was Created Successfully"),n.status(200).redirect("/admin-panel")}).catch(function(e){return n.status(404).json({success:!1})})}),r.post("/:id",function(t,n){var e={name:t.body.name,price:t.body.price};o.findByIdAndUpdate(t.params.id,e).then(function(e){t.flash("alert alert-success","Product was Updated Successfully"),n.status(200).redirect("/admin-panel")}).catch(function(e){return n.status(404)})}),r.delete("/:id",function(e,t){o.findById(e.params.id).then(function(e){return e.remove().then(function(){return t.status(200).json({success:!0})})}).catch(function(e){return t.status(404).json({success:!1})})}),e.exports=r},function(e,t,n){"use strict";var r=n(1).Router(),s=n(0),i=n(5),o=n(2),a=n(8),u=n(3),c=s.model("Admin",u),d=process.env.JWT_KEY||n(4).JWT_KEY,f=n(4).verifyToken;r.post("/login",function(r,s,i){o.authenticate("local",function(e,t,n){return e?(r.flash("alert alert-danger","There was a problem logging in"),i(e)):t?void r.logIn(t,function(e){if(e)return r.flash("alert alert-danger","There was a problem logging in"),i(e);var t={username:r.user.username};a.sign(t,d,{expiresIn:"6h"},function(e,t){return e?s.json({success:!1,message:"Failed to create token"}):(s.cookie("jwt",t),s.redirect("/admin-panel"))})}):(r.flash("alert alert-danger",n.message),s.redirect("/login"))})(r,s)}),r.get("/logout",function(e,t){t.clearCookie("jwt"),e.logout(),e.flash("alert alert-success","You are now logged out"),t.redirect("/login")}),r.post("/register",f,function(n,r){n.checkBody("username","Name is Required").notEmpty(),n.checkBody("password","Password is Required").notEmpty(),n.checkBody("confirmPassword","Passwords do not match").equals(n.body.password);var e=n.validationErrors();if(e)e.forEach(function(e){n.flash("alert alert-danger",e.msg)}),r.status(404).redirect("/admin-panel");else{var s=new c({username:n.body.username,password:n.body.password,addedBy:n.user.username});i.genSalt(10,function(e,t){i.hash(s.password,t,function(e,t){e?console.log(e):(s.password=t,s.save().then(function(e){n.flash("alert alert-success","New Admin was Registered Successfully"),r.status(200).redirect("/admin-panel")}).catch(function(e){console.log(e),r.status(404).json({success:!1})}))})})}}),r.post("/register/:id",f,function(n,r){n.checkBody("username","Name is Required").notEmpty(),n.checkBody("password","Password is Required").notEmpty(),n.checkBody("confirmPassword","Passwords do not match").equals(n.body.password);var e=n.validationErrors();if(e)e.forEach(function(e){n.flash("alert alert-danger",e.msg)}),r.status(404).redirect("back");else{var s={username:n.body.username,password:n.body.password,updatedBy:n.user.username};i.genSalt(10,function(e,t){i.hash(s.password,t,function(e,t){e?console.log(e):(s.password=t,c.findByIdAndUpdate(n.params.id,s).then(function(e){n.flash("alert alert-success","Admin was Updated Successfully"),r.status(200).redirect("/admin-panel")}).catch(function(e){console.log(e),r.status(404)}))})})}}),r.get("/",f,function(e,t){c.find().sort({name:1}).then(function(e){return t.status(200).json(e)}).catch(function(e){return t.status(404)})}),r.get("/:id",f,function(e,t){c.findById(e.params.id).then(function(e){return t.status(200).json(e)}).catch(function(e){return t.status(404).json({success:!1})})}),r.delete("/:id",f,function(e,t){c.findById(e.params.id).then(function(e){return e.remove().then(function(){return t.status(200).json({success:!0})})}).catch(function(e){return t.status(404).json({success:!1})})}),e.exports=r}]);